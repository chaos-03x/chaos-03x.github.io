name: Build and Deploy

on:
  push:
    branches: [ main ] # å½“ 'main' åˆ†æ”¯æœ‰ push æ—¶è§¦å‘
  workflow_dispatch: # å…è®¸ä½ æ‰‹åŠ¨è§¦å‘

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è™šæ‹Ÿæœº

    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3 # ç¬¬ä¸€æ­¥ï¼šæ‹‰å–ä½ çš„æºç 
        with:
          submodules: true

      - name: Setup Node.js ğŸŸ©
        uses: actions/setup-node@v3 # ç¬¬äºŒæ­¥ï¼šå®‰è£… Node.js
        with:
          node-version: '18' # ä½¿ç”¨ Node.js 18
          cache: 'npm'

      - name: Install Dependencies ğŸ“¦
        run: npm install # ç¬¬ä¸‰æ­¥ï¼šå®‰è£… Hexo å’Œæ’ä»¶

      - name: Build ğŸ—ï¸
        run: npm run build # ç¬¬å››æ­¥ï¼šè¿è¡Œ hexo gï¼Œç”Ÿæˆé™æ€æ–‡ä»¶ (åˆ° public ç›®å½•)

      - name: Deploy ğŸš€
        uses: peaceiris/actions-gh-pages@v3 # ç¬¬äº”æ­¥ï¼šä½¿ç”¨ä¸€ä¸ªæµè¡Œçš„ Action æ¥éƒ¨ç½²
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} # ä½¿ç”¨ GitHub è‡ªåŠ¨æä¾›çš„ Token
          publish_dir: ./public # éƒ¨ç½² 'public' æ–‡ä»¶å¤¹
          publish_branch: gh-pages # éƒ¨ç½²åˆ° 'gh-pages' è¿™ä¸ªæ–°åˆ†æ”¯